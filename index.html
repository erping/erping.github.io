<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="薛定谔的喵" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="一只喵的成长之路">
<meta property="og:type" content="website">
<meta property="og:title" content="薛定谔的喵">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="薛定谔的喵">
<meta property="og:description" content="一只喵的成长之路">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="薛定谔的喵">
<meta name="twitter:description" content="一只喵的成长之路">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> 薛定谔的喵 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?f70194dfe3d0179dbe3b00e0a14cfc36";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">薛定谔的喵</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">成长之路</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            公益404
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'erpinggithubio','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/22/布隆过滤器/" itemprop="url">
                  布隆过滤器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-04-22T22:27:38+08:00" content="2016-04-22">
              2016-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/22/布隆过滤器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/22/布隆过滤器/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong>转载请注明作者及出处，如果你觉得这篇文章对你有帮助或启发，也可以来请我<a href="http://7xp01p.com1.z0.glb.clouddn.com/1449296258436.jpg" target="_blank" rel="external">喝咖啡</a></strong></p>
<ul>
<li><strong>简介</strong></li>
</ul>
<p>上篇博客里介绍了位图法，可以判断一个数是否在一个很大的集合里。但是如果问题换成有1亿个邮件地址，如何确定某个邮件地址是否在这个集合里中？这个时候最容易想到的方法就是Hash表了，但是大家可以细想一下，如果利用Hash表来处理，必须开辟空间去存储这1亿个邮件地址，因为在Hash表中不可能避免的会发生碰撞，假设一个邮件地址只占8个字节，为了保证Hash表的碰撞率，所以需要控制Hash表的装填因子在0.5左右，那么至少需要2<em>8</em>108/1024<em>1024</em>1024=1.5G的内存空间，这种情况下利用Hash表是无法处理的。这个时候要用到另外一种数据结构-布隆过滤器（Bloom Filter）它结合了位图和Hash表两者的优点，位图的优点是节省空间，但是只能处理整型值一类的问题，无法处理字符串一类的问题，而Hash表却恰巧解决了位图无法解决的问题，然而Hash太浪费空间。针对这个问题，布隆提出了一种基于二进制向量和一系列随机函数的数据结构-布隆过滤器。它的空间利用率和时间效率是很多算法无法企及的，但是它也有一些缺点，就是会有一定的误判率并且不支持删除操作。</p>
<ul>
<li><strong>算法描述</strong></li>
</ul>
<p>一个empty bloom filter是一个有m bits的bit array，每一个bit位都初始化为0。并且定义有k个不同的hash function，每个都以uniform random distribution将元素hash到m个不同位置中的一个。在下面的介绍中n为元素数，m为布隆过滤器或哈希表的slot数，k为布隆过滤器重hash function数。</p>
<p>为了add一个元素，用k个hash function将它hash得到bloom filter中k个bit位，将这k个bit位置1。<br><img src="http://7xp01p.com1.z0.glb.clouddn.com/bloomfilter.png" alt=""></p>
<p>为了query一个元素，即判断它是否在集合中，用k个hash function将它hash得到k个bit位。若这k bits全为1，则此元素在集合中；若其中任一位不为1，则此元素比不在集合中（因为如果在，则在add时已经把对应的k个bits位置为1）。</p>
<p>不允许remove元素，因为那样的话会把相应的k个bits位置为0，而其中很有可能有其他元素对应的位。因此remove会引入false negative，这是绝对不被允许的(不过现在也有支持删除的布隆过滤器)。</p>
<p>Bloom Filter会有一定的误判率，假设对一个元素进行了hash映射，结果相应的几个位都为1(这些位可能是其他元素映射出来的)，那仍会将其判为在集合中。这就是false positive，从直觉上我们可以判断这一误判率会和映射函数的个数还有bit array的大小有关。具体证明可以<a href="http://www.cnblogs.com/allensun/archive/2011/02/16/1956532.html" target="_blank" rel="external">参考这里</a>。</p>
<ul>
<li><strong>应用场景</strong></li>
</ul>
<p>布隆过滤器在很多场合能发挥很好的效果，比如：网页URL的去重，垃圾邮件的判别，集合重复元素的判别，查询加速（比如基于key-value的存储系统）等，下面举个例子：</p>
<p>有两个URL集合A,B，每个集合中大约有1亿个URL，每个URL占64字节，有1G的内存，如何找出两个集合中重复的URL。</p>
<p>第一种：如果不允许一定的错误率的话，只有用分治的思想去解决，将A,B两个集合中的URL分别存到若干个文件中{f1,f2…fk}和{g1,g2….gk}中，然后取f1和g1的内容读入内存，将f1的内容存储到hash_map当中，然后再取g1中的url，若有相同的url，则写入到文件中，然后直到g1的内容读取完毕，再取g2…gk。然后再取f2的内容读入内存。。。依次类推，知道找出所有的重复url。</p>
<p>第二种：如果允许有一定的错误率，可以使用Bloom filter，4G内存大概可以表示340亿bit。将其中一个文件中的url使用Bloom filter映射为这340亿bit，然后挨个读取另外一个文件的url，检查Bloom filter的相应位，如果都是1，那么该url应该是共同的url。</p>
<ul>
<li><strong>代码实现</strong></li>
</ul>
<p>下面给出一个简单的代码实现：</p>
<pre><code>bitset&lt;<span class="type">MAX</span>&gt; bloomSet;
<span class="comment">#define MAX 2&lt;&lt;24</span>
<span class="type">int</span> seeds[<span class="number">7</span>]={<span class="number">3</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">61</span>};

<span class="type">int</span> getHashValue（<span class="type">string</span> str, <span class="type">int</span> n)
{
    <span class="type">int</span> <span class="literal">result</span> = <span class="number">0</span>;
    <span class="type">int</span> i;
    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;str.size(); i++)
    {
        <span class="literal">result</span> = seeds[n]*<span class="literal">result</span> + (<span class="type">int</span>)str[i];
        <span class="keyword">if</span>(<span class="literal">result</span> &gt; <span class="number">2</span>&lt;&lt;<span class="number">24</span>)
            <span class="literal">result</span> %= <span class="number">2</span>&lt;&lt;<span class="number">24</span>;
    }
    <span class="keyword">return</span> <span class="literal">result</span>;
}

<span class="type">bool</span> isInBloomSet(<span class="type">string</span> str)
{
    <span class="type">int</span> i;
    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)
    {
        <span class="type">int</span> hash = getHashValue(str,i);
        <span class="keyword">if</span>(bloomSet[hash] == <span class="number">0</span>)
            <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}

<span class="type">void</span> addToBloomSet(<span class="type">string</span> str)
{
    <span class="type">int</span> i;
    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)
    {
        <span class="type">int</span> hash = getHashValue(str,i);
        bloomSet.<span class="type">set</span>(hash,<span class="number">1</span>);
    }
}

<span class="type">void</span> initBloomSet()
{
    addToBloomSet(<span class="string">"www.google.com"</span>);
    addToBloomSet(<span class="string">"www.baidu.com"</span>);
    addToBloomSet(<span class="string">"www.qq.com"</span>);
    addToBloomSet(<span class="string">"www.alibaba.com"</span>);
}
</code></pre><p>参考：[1] <a href="http://www.cnblogs.com/dolphin0520/archive/2012/11/10/2755089.html" target="_blank" rel="external">http://www.cnblogs.com/dolphin0520/archive/2012/11/10/2755089.html</a><br>[2] <a href="http://www.cnblogs.com/allensun/archive/2011/02/16/1956532.html" target="_blank" rel="external">http://www.cnblogs.com/allensun/archive/2011/02/16/1956532.html</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/22/位图法/" itemprop="url">
                  位图法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-04-22T21:10:51+08:00" content="2016-04-22">
              2016-04-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/22/位图法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/22/位图法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong>转载请注明作者及出处，如果你觉得这篇文章对你有帮助或启发，也可以来请我<a href="http://7xp01p.com1.z0.glb.clouddn.com/1449296258436.jpg" target="_blank" rel="external">喝咖啡</a></strong></p>
<ul>
<li><strong>定义</strong></li>
</ul>
<p>位图就是bitmap，也就是用一个位来表示某种状态，特别适合数据规模很大，但是数据状态很少的情况。通常用来判断某个数是否存在于集合中。在STL中就有一个叫做bitset的容器，其实就是位图法，引用bitset的介绍：</p>
<blockquote>
<p><em>A bitset is a special container class that is designed to store bits (elements with only two possible values: 0 or 1,true or false, …).The class is very similar to a regular array, but optimizing for space allocation: each element occupies only one bit (which is eight times less than the smallest elemental type in C++: char).Each element (each bit) can be accessed individually: for example, for a given bitset named mybitset, the expression mybitset[3] accesses its fourth bit, just like a regular array accesses its elements.</em></p>
</blockquote>
<ul>
<li><strong>数据结构</strong></li>
</ul>
<p>我们都知道一个字节有8个位，那么表示一个最大值小于等于15的集合用两个字节就可以。</p>
<p><img src="http://7xp01p.com1.z0.glb.clouddn.com/bitmap1.jpg" alt=""></p>
<p>如果将数组[2,10,3,6,14,0]存入上面的位图中，结果为（低位在右侧）</p>
<p><img src="http://7xp01p.com1.z0.glb.clouddn.com/bitmap2.jpg" alt=""></p>
<p>从上图可以清楚的看到存数据的时候只要把相应数据所在的位置1即可。</p>
<ul>
<li><strong>实际应用</strong></li>
</ul>
<p>一、排序</p>
<p>输入：给定一个文件，里面最多含有n个不重复的正整数（也就是说可能含有少于n个不重复正整数），且其中每个数都小于等于n，n=10^7。 输出：得到按从小到大升序排列的包含所有输入的整数的列表。 条件：最多有大约1.5MB的内存空间可用，但磁盘空间足够.</p>
<p>通过分析我们可以发现这个问题有其特殊性：</p>
<ol>
<li>输入数据限制在相对较小的范围内；</li>
<li>数据没有重复；</li>
<li>其中每条记录都是单一的整数，没有任何其他与之关联的数据。</li>
</ol>
<p>所以，可以用位图的方案分以下三部解决：</p>
<ol>
<li>根据数据规模创建位图，并将所有位置0；</li>
<li>通过读入文件的每个整数建立集合，将每个数对应位置1；</li>
<li>遍历创建好的集合，如果该位为1，就输出对应位代表的数字。</li>
</ol>
<p>伪代码如下表示：</p>
<pre><code><span class="keyword">for</span> i = {0,....<span class="keyword">n</span>}
    bit[i] = 0;
<span class="keyword">for</span> each i <span class="keyword">in</span> the <span class="keyword">input</span> <span class="keyword">file</span>
    bit[i] = 1;
<span class="keyword">for</span> i = {0,....<span class="keyword">n</span>}
    <span class="keyword">if</span> bit[i] == 1
        write i <span class="keyword">on</span> the output <span class="keyword">file</span>
</code></pre><p>二、查找</p>
<p>问题：给40亿个不重复的unsigned int的整数，没排过序的，然后再给一个数，如何快速判断这个数是否在那40亿个数当中？</p>
<p>40亿个数大约就是4G个数，按照位图每位存一个数的话，需要4G/8=512M的内存，读入这些数据，设置相应的bit位，读入要查询的数，在位图中查看相应位是否为1，为1表示存在，为0表示不存在。</p>
<p>问题扩展：在2.5亿个整数中找出不重复的整数，注，内存不足以容纳这2.5亿个整数。</p>
<p>一般来说位图适用于数据状态少的情况，1位的话只能表示存在与否，此问题要求的是找出不重复的数，1位就不够用了，所以需要扩展位图用2位来表示更多的状态（每个数分配2bit，00表示不存在，01表示出现一次，10表示出现多次，11无意义），这样需要2^32*2bit=1GB内存。然后扫描这2.5亿个整数，查看Bitmap中相对应位，如果是00变01，01变10，10保持不变。所描完事后，查看bitmap，把对应位是01的整数输出即可。</p>
<p>位图就是一种用位置和状态来描述原来数据的压缩方法，在某些情况下能够用较小的空间/时间复杂度来解决问题，特别是大规模数据的时候。</p>
<p>参考：[1].<a href="http://blog.csdn.net/wypblog/article/details/8237956" target="_blank" rel="external">http://blog.csdn.net/wypblog/article/details/8237956</a></p>
<p>[2].<a href="http://the-art-of-programming-by-july.readthedocs.org/en/latest/ebook/zh/06.07/" target="_blank" rel="external">http://the-art-of-programming-by-july.readthedocs.org/en/latest/ebook/zh/06.07/</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/13/Bash快捷键/" itemprop="url">
                  Bash快捷键
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-04-13T16:50:07+08:00" content="2016-04-13">
              2016-04-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/13/Bash快捷键/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/13/Bash快捷键/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong>转载请注明作者及出处，如果你觉得这篇文章对你有帮助或启发，也可以来请我<a href="http://7xp01p.com1.z0.glb.clouddn.com/1449296258436.jpg" target="_blank" rel="external">喝咖啡</a></strong></p>
<p>当你输入了一长串的命令却发现开头有错误的时候，你会一直按&lt;-使光标移动过去么？当你忘记之前输入的命令的全称的时候你会先history然后执行么？少年，工欲善其事必先利其器，学习一些bash快捷键让你又cool又快。</p>
<p>Ctrl-A 相当于HOME键，用于将光标定位到本行最前面</p>
<p><strong>Ctrl-E 相当于End键，即将光标移动到本行末尾</strong></p>
<p>Ctrl-B 相当于左箭头键，用于将光标向左移动一格</p>
<p>Ctrl-F 相当于右箭头键，用于将光标向右移动一格</p>
<p>Ctrl-D 相当于Del键，即删除光标所在处的字符</p>
<p>Ctrl-K 用于删除从光标处开始到结尾处的所有字符</p>
<p><strong>Ctrl-L 清屏，相当于clear命令</strong></p>
<p><strong>Ctrl-R 进入历史命令查找状态，然后你输入几个关键字符，就可以找到你使用过的命令</strong></p>
<p><strong>Ctrl-U 用于删除从光标开始到行首的所有字符。一般在密码或命令输入错误时常用</strong></p>
<p>Ctrl-H 删除光标左侧的一个字符</p>
<p>Ctrl-W 用于删除当前光标左侧的一个单词</p>
<p><strong>Ctrl-P 相当于上箭头键，即显示上一个命令</strong></p>
<p>Ctrl-N 相当于下箭头键，即显示下一个命令</p>
<p>Ctrl-J 相当于回车键</p>
<p>Alt-. 用于提取历史命令中的最后一个单词。你先执行history命令，然后再敲击此快捷键若干下，你就懂了！</p>
<p>Alt-BackSpace 用于删除本行所有的内容，基本上和Ctrl-U类似。</p>
<p>Alt-C 用于将当前光标处的字符变成大写，同时本光标所在单词的后续字符都变成小写。</p>
<p>Alt-L 用于将光标所在单词及所在单词的后续字符都变成小写。</p>
<p>Alt-U 用于将光标所在单词的光标所在处及之后的所有字符变成大写。</p>
<p>黑体的是推荐的常用快捷键，多用几次很快就熟悉啦。人生又省出很多时间，可以进行思考了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/02/Linux创建进程的方法/" itemprop="url">
                  Linux创建进程的方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-02T22:51:00+08:00" content="2016-03-02">
              2016-03-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/02/Linux创建进程的方法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/02/Linux创建进程的方法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong>转载请注明作者及出处，如果你觉得这篇文章对你有帮助或启发，也可以来请我<a href="http://7xp01p.com1.z0.glb.clouddn.com/1449296258436.jpg" target="_blank" rel="external">喝咖啡</a></strong></p>
<p>在Linux中主要提供了fork、vfork、clone三种创建进程的方法。下面我们分别介绍他们的特点以及不同之处。</p>
<p><strong>fork</strong></p>
<p>创建进程最常用的就是fork，这样得到的子进程完全复制父进程的资源，仅有少量信息如task_struct结构和pid父子进程是不同的。但是比如文件描述符，打开的文件的读写位置指针等都是相同的。这样得到的子进程独立于父进程，具有良好的并发性，但是两者之间的通信需要专门的通信机制比如管道，共享内存。因为子进程存有父进程的资源副本，所以fork是一个开销很大的系统调用。有时候这样是很不必要的，比如fork出来的子进程仅仅是为了调用exec执行另外的程序，那么fork过程的复制将是一个多余的过程。现在的Linux采用了写时复制的技术，为了降低开销，fork最初并不会真正产生两个不同的拷贝，因为那个时候，大量的数据其实是一样的。写时复制推迟了真正的数据拷贝。若后来确实发生了写入，那那意味着parent和child的数据不一致了，于是产生复制动作，每个进程拿到属于自己的那一份，这样就可以降低系统调用的开销。所以有了写时复制后呢，vfork其实现意义就不大了(后面会讲到)。</p>
<p>fork调用执行一次返回两个值，对于父进程，fork函数返回子程序的进程号，而对于子程序，fork函数则返回零，这就是一个函数返回两次的本质。 </p>
<p>在fork之后，子进程和父进程都会继续执行fork调用之后的指令。子进程是父进程的副本。它将获得父进程的数据空间，堆和栈的副本，这些都是副本，父子进程并不共享这部分的内存。也就是说，子进程对父进程中的同名变量进行修改并不会影响其在父进程中的值。但是父子进程又共享一些东西，简单说来就是程序的正文段。正文段存放着由cpu执行的机器指令，通常是read-only的。</p>
<p><strong>vfork</strong></p>
<p>既然有了fork，为什么还会有vfork呢？看fork的man page我们就可以知道啦。</p>
<p><em>In the bad old days a fork would require making a complete copy of the caller’s data space, often needlessly, since usually immediately afterwards an exec is done. Thus, for greater efficiency, BSD introduced the vfork system call, which did not fully copy the address space of the parent process, but borrowed the parent’s memory and thread of control until a call to execve or an exit occurred. The parent process was suspended while the child was using its resources. The use of vfork was tricky: for example, not modifying data in the parent process depended on knowing which variables are held in a register</em></p>
<p>就是为了处理上文分析的fork后子进程马上exec一个外部程序使得复制没意义这样的问题，BSD提出了vfork，这样会使父子进程共享地址空间。这个时候如果子进程修改了某个变量，父进程也会做同样的修改。</p>
<p>但此处有一点要注意的是用vfork创建的子进程必须显示调用exit()来结束，用return会挂掉，详细情况有兴趣的可以参考<a href="http://coolshell.cn/articles/12103.html" target="_blank" rel="external">这篇文章</a>。用 vfork创建子进程后，父进程会被阻塞直到子进程调用exec或exit，这也就是说vfork会保证子进程先运行，而fork的情况下两者是竞争关系，运行顺序无法得到保证。</p>
<p><strong>clone</strong></p>
<p>clone的函数原型<br>int clone(int (<em>fn)(void </em>), void <em>child_stack, int flags, void </em>arg);</p>
<p>系统调用fork和vfork是无参数的，而clone则带有参数。fork是全部复制，vfork是共享内存，而clone是则可以将父进程资源有选择地复制给子进程，而没有复制的数据结构则通过指针的复制让子进程共享，具体要复制哪些资源给子进程，由参数列表中的 flags来决定。另外，clone返回的是子进程的pid。</p>
<p>以上就是Linux下的几种创建进程的方式，vfork比较危险，如果不是特别关注性能不建议使用，clone提供了复杂的参数，可以实现对子进程较为精细的控制，在实践中应该根据自己需求选择合适的调用。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/30/linux常用命令/" itemprop="url">
                  linux常用命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-30T11:06:24+08:00" content="2016-01-30">
              2016-01-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/30/linux常用命令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/30/linux常用命令/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong>转载请注明作者及出处，如果你觉得这篇文章对你有帮助或启发，也可以来请我<a href="http://7xp01p.com1.z0.glb.clouddn.com/1449296258436.jpg" target="_blank" rel="external">喝咖啡</a></strong></p>
<p>自己电脑以前用的就是Ubuntu的，虽然不怎么方便，但是命令用的熟啊。后来重装了Windows，命令逐渐生疏，今天就总结一下，算是温故知新。</p>
<p> <strong>帮助命令</strong></p>
<p>$<strong>man</strong> <em>command</em></p>
<p>查询命令<em>command</em>的说明文档</p>
<p>$<strong>info</strong> <em>command</em></p>
<p>更加详细的说明文档</p>
<p>$<strong>whatis</strong> <em>command</em></p>
<p>简要说明</p>
<p>$<strong>which</strong> <em>command</em></p>
<p><em>command</em>的binary文件所在路径</p>
<p>$<strong>whereis</strong> <em>command</em></p>
<p>在搜索路径中的所有<em>command</em></p>
<p> <strong>用户</strong></p>
<p>$<strong>finger</strong> <em>username</em></p>
<p>显示用户<em>username</em>的信息</p>
<p>$<strong>who</strong></p>
<p>显示当前登录的用户</p>
<p>$<strong>passwd</strong></p>
<p>更改密码</p>
<p> <strong>SHELL（BASH）</strong></p>
<p>$<strong>history</strong></p>
<p>显示当前shell下的命令历史</p>
<p>$<strong>!num</strong></p>
<p>!加在<em>history</em>后的数字即为执行那条命令</p>
<p>$<strong>alias</strong></p>
<p>显示所有的命令别名</p>
<p>$<strong>alias new_command=’command’</strong></p>
<p>将command用newcommand代替</p>
<p>$<strong>expr 1 + 1</strong></p>
<p>数学计算，注意运算符前后的空格不可缺少</p>
<p> <strong>文件系统</strong></p>
<p>$<strong>du -sh dir</strong></p>
<p>显示文件夹大小， -h 人类可读的单位， -s 摘要信息</p>
<p>$<strong>find pathname -option [-print]<br> [-exec -ok command] {}  \</strong></p>
<p>其中的option常用的有name,perm,mtime,size,depth,type等等，print就是打印找到的东西，exec和ok都是对找到的文件执行command的命令，区别在于ok会询问用户，{}指代了查找到的文件注意{}和\之间的空格。其实也可以用管道加xargs，效果同exec。</p>
<p>$<strong>cd ~</strong></p>
<p>回到主目录</p>
<p>$<strong>cd -</strong></p>
<p>回到上次操作的目录</p>
<p>$<strong>df</strong></p>
<p>检查文件系统磁盘空间占用情况</p>
<p>$<strong>fdisk</strong></p>
<p>对磁盘进行分区</p>
<p> <strong>进程</strong></p>
<p>$<strong>top</strong></p>
<p>显示进程信息，并实时更新。包含的内容很多，有负载情况，内存、CPU的使用情况，swap，进程状态等等</p>
<p>$<strong>ps</strong></p>
<p>显示当前shell下的进程</p>
<p>$<strong>kill PID</strong></p>
<p>杀死PID进程</p>
<p>$<strong>kill %job</strong></p>
<p>杀死job工作</p>
<p>$<strong>dmesg</strong></p>
<p>显示系统日志</p>
<p> <strong>网络</strong></p>
<p>$<strong>ifconfig</strong></p>
<p>显示网络接口以及ip地址</p>
<p>$<strong>route</strong></p>
<p>显示路由表，也可以用于修改路由表</p>
<p>$<strong>netstat</strong></p>
<p>显示当前网络连接状态</p>
<p>$<strong>ping IP</strong></p>
<p>发送ping包到地址ip</p>
<p>$<strong>traceroute ip</strong></p>
<p>探测到地址ip的路由路径</p>
<p>$<strong>wget url</strong></p>
<p>下载URL指向的资源</p>
<p>上面的命令都是一些最简单的介绍，参数什么的都没有具体讲，学习最主要的是方法，知道一些命令的大概功能后，不懂的man一下就行了。让我们在linux的世界里愉快的玩耍吧。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/qisimiao.jpg" alt="erping" itemprop="image"/>
          <p class="site-author-name" itemprop="name">erping</p>
        </div>
        <p class="site-description motion-element" itemprop="description">一只喵的成长之路</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/erping" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">erping</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"erpinggithubio"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</body>
</html>
